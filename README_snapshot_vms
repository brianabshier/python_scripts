Description:
------------
This script automates the creation of snapshots for all active OpenStack instances
in your project. It also cleans up old snapshots beyond a configured retention count,
tracks instances to detect when VMs are added or removed, and also allows you to exclude VMs based on ID or naming conventions.

Features:
---------
- Authenticates using OpenStack API with Application Credentials.
- Creates snapshots named with a prefix, instance name, and timestamp.
- Keeps a configurable number of snapshots per instance (retention policy).
- Tracks instance changes between runs.
- Supports staggering snapshot creation to avoid resource spikes.
- Saves instance state in a local JSON file.
- Allows the exclusion of VMs via UUID and/or naming conventions.

Requirements:
-------------
- Python 3.x
- openstacksdk library (`pip install openstacksdk`)
- Access to OpenStack with Application Credentials
- python-openstackclient 5.5.0+ CLI support for --os-application-credential-id
- keystoneauth1 5.1.0+ Authentication backend for Application Credentials
- openstacksdk 1.3.0+ (For Python scripts) Supports auth_type='v3applicationcredential

Usage:
------
1. Configure your OpenStack authentication parameters in the script (AUTH_ARGS).
2. Optionally adjust settings like:
   - SNAPSHOT_PREFIX (default: "auto-snap")
   - SNAPSHOT_RETENTION (default: 3)
   - STAGGER_SECONDS (default: 10)
   - DATA_FILE (state file location)
   - place .snapshot_data/exclude_ids.txt with a list of VM UUIDs to exclude
   - place .snapshot_data/exclude_names.txt with a list of VM names to exclude (Supports wildcards)
3. Run the script:
   python snapshot_vms.py

Schedule this script using cron or another scheduler for regular snapshots.

Notes:
- The script stores instance state in a JSON file (vm_state.json by default).
- Ensure the script has write permission in its working directory.
- Snapshot names follow the pattern: auto-snap-<instance_name>-YYYYMMDD-HHMMSS
- Adjust retention to control how many snapshots to keep per instance.

Author: Brian Abshier
License: MIT License
